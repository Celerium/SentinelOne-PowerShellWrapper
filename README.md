# SentinelOne API PowerShell Wrapper

This PowerShell module acts as a wrapper for the [SentinelOne](https://www.SentinelOne.com/) API.

:warning: **As of 2022-11, I have only done the GET endpoints and do plan on implementing the others. Its just the S1 has almost 400 endpoints so its a lot of work and I am doing this in my spare time.**

:warning: **See ToDo list below for more information on whats next**

---

## Introduction

The SentinelOne's API offers users the ability to extract data from SentinelOne into third-party reporting tools.

- Full documentation for SentinelOne's RESTful API can be found under your management portal.

This module serves to abstract away the details of interacting with SentinelOne's API endpoints in such a way that is consistent with PowerShell nomenclature. This gives system administrators and PowerShell developers a convenient and familiar way of using SentinelOne's API to create documentation scripts, automation, and integrations.

### Function Naming

SentinelOne features a REST API that makes use of common HTTPs GET, POST, PUT, and DELETE actions. In order to maintain PowerShell best practices, only approved verbs are used.

- GET -> Get-
- GET -> Connect-
- GET -> Export-
- :warning:POST -> New-
- :warning:PUT -> Set-
- :warning:DELETE -> Remove-

Additionally, PowerShell's `verb-noun` nomenclature is respected. Each noun is prefixed with `S1` in an attempt to prevent naming problems.

For example, one might access the `/accounts` API endpoint by running the following PowerShell command:

```posh
Get-S1Accounts
```

---

## Install & Import

This module can be installed directly from the [PowerShell Gallery](https://www.powershellgallery.com/packages/SentinelOneAPI) with the following command:

- :information_source: This module supports PowerShell 5.0 and at this time it does not fully work in PowerShell Core.

```posh
Install-Module -Name SentinelOneAPI
```

If you are running an older version of PowerShell, or if PowerShellGet is unavailable, you can manually download the *Master* branch and place the *SentinelOneAPI* folder into the (default) `C:\Program Files\WindowsPowerShell\Modules` folder.

After installation (by either methods), load the module into your workspace:

```posh
Import-Module SentinelOneAPI
```

---

## Initial Setup

After importing this module, you will need to configure both the *base URI* & *API access token* that are used to talk with the SentinelOne API.

1. Run `Add-S1BaseURI -baseMgmt_uri 'https://MGMT-Console-URI.sentinelone.net'`
   - By default, you will need to define your management consoles url.
   - The 'baseApi_uri' parameter allows you to adjust in the event the API version is updated. By default it uses `/web/api/v2.1`

2. Run `Add-S1APIKey`
   - It will prompt you to enter in your API access token
   - SentinelOne API access tokens can be generated by going to *SentinelOne > User > Options*

[optional]

1. Run `Export-S1ModuleSettings`

   - This will create a config file at `%UserProfile%\SentinelOneAPI` that securely holds the *base uri* & *API access token* information.
   - Next time you run `Import-Module -Name SentinelOneAPI`, this configuration file will automatically be loaded.
      - :warning: Exporting module settings encrypts your API access token in a format that can **only be unencrypted with your Windows account**. It makes use of PowerShell's `Windows Data Protection API (DPAPI)` type, which uses reversible encrypted tied to your user principal. This means that you cannot copy your configuration file to another computer or user account and expect it to work.
      - :warning: Exporting and importing module settings requires use of the `ConvertTo-SecureString` cmdlet, which I have not tested in PowerShell core.

---

## Usage

Calling an API resource is as simple as running `Get-S1<resourceName>`

- The following is a table of supported functions and their corresponding API resources:
- Table entries with [ `-` ] indicate that the functionality is NOT supported by the SentinelOne API at this time.

| API Resource       | Create    | Read                             | Update    | Delete    |
| -----------------  | --------- | -------------------------------- | --------- | --------- |
| Account            | -         | `Get-S1Placeholder`              | -         | -         |
| Agents             | -         | `Get-S1Placeholder`              | -         | -         |
| Apps               | -         | `Get-S1Placeholder`              | -         | -         |

Each `Get-S1*` function will respond with the raw data that SentinelOne's API provides.

---

## Help :blue_book:

Some resources allow for filters and parameters to be used to specify the desired output from SentinelOne's API.

- A full list of functions can be retrieved by running `Get-Command -Module SentinelOneAPI`.
- Help info and a list of parameters can be found by running `Get-Help <command name>`, such as:

```posh
Get-Help Get-S1Accounts
Get-Help Get-S1Accounts -Full
```

---

## Primary ToDo List :dart:

- [ ] Documentation automation & updatable help
- [ ] Validate GET command structure, parameters and usage `(Not all commands are fully validated due to various issues or permissions)`
- [ ] Build a better API parameter to more securely handle API keys
- [ ] Add compatibility with PowerShell Core

## Secondary ToDo List :dart:

- [ ] Implement other METHODS `( DELETE, POST, PUT )`
- [ ] Example scripts & reports
- [ ] Build more robust Pester & ScriptAnalyzer tests
- [ ] Figure out how to do CI & PowerShell gallery automation
